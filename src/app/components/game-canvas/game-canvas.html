<app-safe-container>
  <div
    class="flex h-full w-full flex-col items-center justify-center bg-gray-900"
    #containerElement
  >
    <div class="relative touch-none" #gestureContainer>
      <canvas
        #gameCanvas
        class="pointer-events-none rounded-2xl border-4 border-white bg-green-100 shadow-2xl"
        [width]="gameState.canvasWidth()"
        [height]="gameState.canvasHeight()"
      >
      </canvas>

      <!-- Floating circular control buttons -->
      <div
        class="pointer-events-none absolute inset-x-0 bottom-0 z-10 flex items-end justify-between px-4 pb-4 select-none"
        aria-hidden="false"
      >
        <!-- Pause Button -->
        <button
          type="button"
          class="pointer-events-auto h-14 w-14 rounded-full bg-black/70 text-white shadow-lg backdrop-blur transition-opacity duration-50"
          [style.opacity]="pauseOpacity()"
          (click)="togglePause(); $event.stopPropagation()"
          aria-label="Pause"
        >
          <fa-icon [icon]="iconPause" class="text-xl"></fa-icon>
        </button>

        <!-- Turbo Button (hold to activate) -->
        <button
          type="button"
          class="pointer-events-auto h-14 w-14 rounded-full bg-black/70 text-yellow-300 shadow-lg backdrop-blur transition-opacity duration-50"
          [style.opacity]="turboOpacity()"
          (pointerdown)="onTurboPressStart(); $event.stopPropagation()"
          (pointerup)="onTurboPressEnd(); $event.stopPropagation()"
          (pointercancel)="onTurboPressEnd(); $event.stopPropagation()"
          (pointerleave)="onTurboPressEnd(); $event.stopPropagation()"
          [class.opacity-90]="isTurboActive()"
          [class.scale-105]="isTurboActive()"
          aria-label="Turbo"
        >
          <fa-icon [icon]="iconBolt" class="text-xl"></fa-icon>
        </button>

        <!-- Special Action Button -->
        <button
          type="button"
          class="pointer-events-auto h-14 w-14 rounded-full bg-black/70 text-indigo-300 shadow-lg backdrop-blur transition-opacity duration-50"
          [style.opacity]="specialOpacity()"
          (click)="onSpecialAction(); $event.stopPropagation()"
          aria-label="Special Action"
        >
          <fa-icon [icon]="iconStar" class="text-xl"></fa-icon>
        </button>
      </div>

      <!-- Mobile Game Status Overlay -->
      @if (gameState.gameStatus() !== "playing") {
        <div
          class="absolute inset-0 flex items-center justify-center rounded-2xl bg-black/60"
        >
          <div
            class="mx-4 w-full max-w-sm rounded-2xl bg-white p-6 text-center shadow-2xl"
          >
            @switch (gameState.gameStatus()) {
              @case ("menu") {
                <h2 class="mb-6 text-3xl font-bold">üêç Ready to Play?</h2>
                <button
                  (click)="startGame()"
                  class="w-full rounded-xl bg-green-600 py-4 text-lg font-semibold text-white transition-all duration-200 hover:scale-105 hover:bg-green-700 active:scale-95"
                >
                  Start Game
                </button>
              }
              @case ("paused") {
                <h2 class="mb-6 text-3xl font-bold">‚è∏Ô∏è Game Paused</h2>
                <button
                  (click)="togglePause()"
                  class="w-full rounded-xl bg-blue-600 py-4 text-lg font-semibold text-white transition-all duration-200 hover:scale-105 hover:bg-blue-700 active:scale-95"
                >
                  Resume Game
                </button>
              }
              @case ("gameOver") {
                <h2 class="mb-4 text-3xl font-bold">üéÆ Game Over!</h2>
                <div class="mb-6 space-y-3 text-lg">
                  <div class="flex justify-between">
                    <span>Final Score:</span>
                    <strong>{{ gameState.score() }}</strong>
                  </div>
                  <div class="flex justify-between">
                    <span>Final Length:</span>
                    <strong>{{ gameState.currentLength() }}</strong>
                  </div>
                  <div class="flex justify-between text-yellow-600">
                    <span>Coins Earned:</span>
                    <strong>+{{ coinsEarned() }} ü™ô</strong>
                  </div>
                </div>
                <div class="space-y-3">
                  <button
                    (click)="startGame()"
                    class="w-full rounded-xl bg-green-600 py-4 text-lg font-semibold text-white transition-all duration-200 hover:scale-105 hover:bg-green-700 active:scale-95"
                  >
                    Play Again
                  </button>
                  <button
                    (click)="goBack()"
                    class="w-full rounded-xl bg-gray-600 py-3 text-base font-semibold text-white transition-all duration-200 hover:scale-105 hover:bg-gray-700 active:scale-95"
                  >
                    Back to Menu
                  </button>
                </div>
              }
            }
          </div>
        </div>
      }
    </div>
  </div>
</app-safe-container>
